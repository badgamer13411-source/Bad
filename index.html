<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProEarn - Digital Earning</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #28a745; --bg: #f4f7f6; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 70px; }
        .page { display: none; padding: 20px; animation: fadeIn 0.3s; text-align: center; }
        .active-page { display: flex; flex-direction: column; align-items: center; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background: var(--white); border-radius: 20px; padding: 25px; width: 90%; max-width: 350px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-top: 20px; }
        input { width: 90%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: var(--white); display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #eee; }
        .nav-item { color: #aaa; font-size: 11px; display: flex; flex-direction: column; align-items: center; cursor: pointer; text-decoration: none; }
        .nav-item.active { color: var(--primary); }
        #timer { color: red; font-weight: bold; font-size: 18px; margin-bottom: 10px; display: none; }
    </style>
</head>
<body onload="init()">

    <div id="loginPage" class="page active-page">
        <h2 style="color:var(--primary);">ProEarn Login</h2>
        <div class="card">
            <p>Phone or Email se account banayein</p>
            <input type="text" id="loginUser" placeholder="Phone or Email">
            <input type="password" id="loginPass" placeholder="Create Password">
            <button class="btn-main" onclick="handleLogin()">Create Account / Login</button>
        </div>
    </div>

    <div id="home" class="page">
        <div class="card">
            <p style="color:#666; margin:0;">Total Balance</p>
            <h1 style="margin:10px 0;">₹<span id="balDisp">0.00</span></h1>
            <div id="timer">Wait: <span id="secs">30</span>s</div>
            <button class="btn-main" id="adBtn" onclick="watchAd()">Watch Video Ad (₹0.50)</button>
        </div>
    </div>

    <div id="invite" class="page">
        <h2>Invite & Earn</h2>
        <div class="card">
            <i class="fas fa-gift" style="font-size: 50px; color: gold;"></i>
            <p>Doston ko invite karein aur payein <b>₹5</b> per referral!</p>
            <button class="btn-main" onclick="shareApp()">Invite on WhatsApp</button>
        </div>
    </div>

    <div id="withdraw" class="page">
        <h2>Withdrawal</h2>
        <div class="card">
            <p style="color:red; font-size:12px;">5% processing fee kategi.</p>
            <input type="number" id="wAmt" placeholder="Minimum ₹100"> "medium ₹200"> "maximum ₹500">
            <p id="feeInfo" style="font-size:13px;"></p>
            <button class="btn-main" onclick="doWithdraw()">Withdraw Now</button>
        </div>
    </div>

    <div id="navBar" class="nav-bar" style="display:none;">
        <div class="nav-item active" onclick="nav('home', this)"><i class="fas fa-home"></i><span>Home</span></div>
        <div class="nav-item" onclick="nav('invite', this)"><i class="fas fa-users"></i><span>Invite</span></div>
        <div class="nav-item" onclick="nav('withdraw', this)"><i class="fas fa-wallet"></i><span>Withdraw</span></div>
    </div>

    <script>
        let bal = parseFloat(localStorage.getItem('proEarnBal')) || 0.0;
        const adLink = "https://www.effectivegatecpm.com/vughxc0v?key=602f39b05878d3f11c2c26d53e7d5568";

        function init() {
            if(localStorage.getItem('isLoggedIn')) {
                showDashboard();
            }
            checkReferral();
        }

  // --- UPDATED LOGIN & REFERRAL REWARD LOGIC ---
function handleLogin() {
    let u = document.getElementById('loginUser').value;
    let p = document.getElementById('loginPass').value;
    
    if(u.length > 5 && p.length > 3) {
        // 1. Account create hote hi check karega koi referral hai ya nahi
        const urlParams = new URLSearchParams(window.location.search);
        const refCode = urlParams.get('ref');

        // 2. Agar ref code hai aur ye iska pehla login hai
        if (refCode && !localStorage.getItem('isLoggedIn')) {
            let inviteReward = 5.00; // Yeh raha aapka ₹5 reward
            bal += inviteReward;
            alert("Referral Success! ₹" + inviteReward + " added to your wallet.");
        }

        // 3. User ko login karado
        localStorage.setItem('isLoggedIn', 'true');
        localStorage.setItem('userAccount', u);
        save(); // Balance save karo
        showDashboard();
    } else { 
        alert("Sahi Details bharein!"); 
    }
}
        }

        function showDashboard() {
            document.getElementById('loginPage').classList.remove('active-page');
            document.getElementById('home').classList.add('active-page');
            document.getElementById('navBar').style.display = 'flex';
            updateDisp();
        }

        // --- REFERRAL REWARD (LINE 146) ---
        function checkReferral() {
            const urlParams = new URLSearchParams(window.location.search);
            const ref = urlParams.get('ref');
            if (ref && !localStorage.getItem('bonusTaken')) {
                
                let inviteReward = 5.00; // <--- YAHAN HAI REFERRAL KA 5 RUPYE
                
                bal += inviteReward;
                localStorage.setItem('bonusTaken', 'true');
                save();
                alert("Referral Bonus ₹" + inviteReward + " Added!");
            }
        }

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active-page');
            el.classList.add('active');
        }

        function watchAd() {
            window.open(adLink, '_blank');
            let btn = document.getElementById('adBtn'), t = document.getElementById('timer'), s = document.getElementById('secs');
            btn.disabled = true; t.style.display = 'block';
            let left = 30;
            let count = setInterval(() => {
                left--; s.innerText = left;
                if(left <= 0) {
                    clearInterval(count);
                    btn.disabled = false; t.style.display = 'none';
                    bal += 0.50; save(); alert("Ad reward ₹0.50 added!");
                }
            }, 1000);
        }

        function shareApp() {
            let link = window.location.origin + window.location.pathname + "?ref=" + Math.floor(Math.random()*999);
            window.open("https://api.whatsapp.com/send?text=Bhai ghar baithe kamao! Join ProEarn: " + link);
        }

        function doWithdraw() {
            let a = document.getElementById('wAmt').value;
            if(bal < a) { alert("Balance kam hai!"); }
            else { 
                let fee = a * 0.05;
                alert(`Request Sent! ₹${a - fee} (After 5% fee) will be sent to your UPI.`);
                bal -= a; save();
            }
        }

        function save() { localStorage.setItem('proEarnBal', bal); updateDisp(); }
        function updateDisp() { document.getElementById('balDisp').innerText = bal.toFixed(2); }
    </script>
</body>
</html>
